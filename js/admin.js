var web3;
var account;
var ballotContract;
var contractInst;
var contractObj;
var res = -1;
var addr;
var state;
var regTimeDate;
var regTime;
var voteTime;
var voteTimeDate;
var mode;
var question;
var winners;
var candidateList;


window.addEventListener('load', function() {
	state=0;
	var btn = document.getElementById("startelection-button"); 
	btn.disabled = false;
	if (typeof web3 !== 'undefined') {
		window.web3 = new Web3(web3.currentProvider);
		console.log("Connected to MetaMask vK");
	} else {
		// set the provider you want from Web3.providers
		console.log("MetaMask not Connected");
		//web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
	}
	
	
	getStateFromServer();


})


function displayPreElection() {
	var div = document.getElementById("phase0-div");
		div.style.display = "block";
	div = document.getElementById("phase12-div");
		div.style.display = "none";
	div = document.getElementById("phase3-div");
		div.style.display = "none";
}

function displayDuringElection() {
	var div = document.getElementById("phase0-div");
		div.style.display = "none";
	div = document.getElementById("phase12-div");
		div.style.display = "block";
	div = document.getElementById("phase3-div");
		div.style.display = "none";
}

function displayPostElection() {
	var div = document.getElementById("phase0-div");
		div.style.display = "none";
	div = document.getElementById("phase12-div");
		div.style.display = "none";
	div = document.getElementById("phase3-div");
		div.style.display = "block";
}

function startNew() {
	state = 0;
	sendState("0");
	location.reload(true);
}

/**Creates a new ballot contract. Contract address is needed for all other transactions.
*
*/
function createBallot(){
	var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100);


	storeParams();

	//console.log(ballotContract);
	if (mode ==="Basic"){
		var ballotContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
		contractObj = ballotContract.at(account);
		ballotContract.new(
		   {
			   
			 from: account, 
			 data: '0x6060604052341561000c57fe5b5b6000600660006101000a81548160ff021916908360ff16021790555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b610f8e8061007b6000396000f300606060405236156100e4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631ec6b60a146100e6578063230d6ed8146100f85780632f265cf71461011c578063392e66781461015a578063443019fe146101965780637b4cd5b4146101eb5780638e7ea5b21461023b578063a69beaba146102b0578063b13c744b146102d4578063c68130dc14610310578063ea35e8051461034e578063eced0280146103c3578063f4ab9adf146103ef578063f851a44014610425578063f909430314610477578063fdbc400614610489575bfe5b34156100ee57fe5b6100f66104fe565b005b341561010057fe5b61011a600480803560001916906020019091905050610574565b005b341561012457fe5b61013e6004808035600019169060200190919050506106b1565b604051808260ff1660ff16815260200191505060405180910390f35b341561016257fe5b61017c6004808035600019169060200190919050506106ff565b604051808215151515815260200191505060405180910390f35b341561019e57fe5b6101ca600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610765565b60405180838152602001821515151581526020019250505060405180910390f35b34156101f357fe5b61021f600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610796565b604051808260ff1660ff16815260200191505060405180910390f35b341561024357fe5b61024b6107b6565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461029d575b80518252602083111561029d57602082019150602081019050602083039250610279565b5050509050019250505060405180910390f35b34156102b857fe5b6102d2600480803560001916906020019091905050610839565b005b34156102dc57fe5b6102f260048080359060200190919050506109be565b60405180826000191660001916815260200191505060405180910390f35b341561031857fe5b6103326004808035600019169060200190919050506109e3565b604051808260ff1660ff16815260200191505060405180910390f35b341561035657fe5b61035e610a03565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146103b0575b8051825260208311156103b05760208201915060208101905060208303925061038c565b5050509050019250505060405180910390f35b34156103cb57fe5b6103d3610ced565b604051808260ff1660ff16815260200191505060405180910390f35b34156103f757fe5b610423600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610d05565b005b341561042d57fe5b610435610dab565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561047f57fe5b610487610dd1565b005b341561049157fe5b610499610e47565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146104eb575b8051825260208311156104eb576020820191506020810190506020830392506104c7565b5050509050019250505060405180910390f35b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610571576001600660006101000a81548160ff021916908360ff1602179055505b5b565b6000600660009054906101000a900460ff1660ff1614156106ad576000816000191614156105a1576106ae565b6105aa816106ff565b156105b4576106ae565b6005600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660ff161115610611576106ae565b600180548060010182816106259190610eaa565b916000526020600020900160005b83909190915090600019169055506001600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055505b5b50565b6000600015156106c0836106ff565b151514156106ce5760006000fd5b60046000836000191660001916815260200190815260200160002060009054906101000a900460ff1690505b919050565b60006000600090505b60018054905081101561075a57826000191660018281548110151561072957fe5b906000526020600020900160005b505460001916141561074c576001915061075f565b5b8080600101915050610708565b600091505b50919050565b60026020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b60036020528060005260406000206000915054906101000a900460ff1681565b6107be610ed6565b6003600660009054906101000a900460ff1660ff16141561083557600580548060200260200160405190810160405280929190818152602001828054801561082957602002820191906000526020600020905b81546000191681526020019060010190808311610811575b50505050509050610836565b5b90565b6001600660009054906101000a900460ff1660ff1614156109ba576001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415806108f25750600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff165b156108fc576109bb565b60001515610909826106ff565b151514156109175760006000fd5b600160046000836000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055506001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055505b5b50565b6001818154811015156109cd57fe5b906000526020600020900160005b915090505481565b60046020528060005260406000206000915054906101000a900460ff1681565b610a0b610ed6565b600060006002600660009054906101000a900460ff1660ff16148015610a7e5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15610ce75760009150600090505b600180549050811015610c6f578160046000600184815481101515610aad57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161415610b3d5760058054806001018281610afe9190610eaa565b916000526020600020900160005b600184815481101515610b1b57fe5b906000526020600020900160005b505490919091509060001916905550610c61565b8160046000600184815481101515610b5157fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161115610c60576000604051805910610b9d5750595b908082528060200260200182016040525b5060059080519060200190610bc4929190610eea565b5060046000600183815481101515610bd857fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16915060058054806001018281610c259190610eaa565b916000526020600020900160005b600184815481101515610c4257fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050610a8c565b6003600660006101000a81548160ff021916908360ff1602179055506005805480602002602001604051908101604052809291908181526020018280548015610cdb57602002820191906000526020600020905b81546000191681526020019060010190808311610cc3575b50505050509250610ce8565b5b505090565b6000600660009054906101000a900460ff1690505b90565b6000600660009054906101000a900460ff1660ff161415610da7576040604051908101604052806001815260200160001515815250600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff0219169083151502179055509050505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610e44576002600660006101000a81548160ff021916908360ff1602179055505b5b565b610e4f610ed6565b6001805480602002602001604051908101604052809291908181526020018280548015610e9f57602002820191906000526020600020905b81546000191681526020019060010190808311610e87575b505050505090505b90565b815481835581811511610ed157818360005260206000209182019101610ed09190610f3d565b5b505050565b602060405190810160405280600081525090565b828054828255906000526020600020908101928215610f2c579160200282015b82811115610f2b578251829060001916905591602001919060010190610f0a565b5b509050610f399190610f3d565b5090565b610f5f91905b80821115610f5b576000816000905550600101610f43565b5090565b905600a165627a7a72305820ff1f3584d009c341f728a176ff8df8a80b976183f7e150e6e13f3100ccbd10d40029', 
			 gas: '4700000'
		   }, function (e, contract){
			   if (typeof contract !== 'undefined' && typeof contract.address !== 'undefined') {
					 addr = contract.address;
					 //sendAddr(addr);
					 sendParamsToServer();
					 contractInst = contract;
					 console.log("about to set timeout");
					setTimeout(endPhase1, regTimeDate*60000); 
				} else {
					console.log(e);
				}
			
		 });
		
	} if (mode === "Preferential"){
		var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
		contractObj = ballotContract.at(account);
		ballotContract.new(
		   {
			 from: account, 
			 data: '0x6060604052341561000c57fe5b5b60006005819055506000600a60006101000a81548160ff021916908360ff16021790555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b611c67806100836000396000f30060606040523615610126576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630d15fd77146101285780631b2a87151461014e5780631ec6b60a146101ca578063230d6ed8146101dc5780632f265cf714610200578063392e66781461023e578063443019fe1461027a5780634e9384da146102cf5780636ace7d87146103315780637b4cd5b4146103435780638244b42f14610393578063b13c744b146103dc578063c68130dc14610418578063dd7bff8214610456578063df15c37e14610468578063ea35e805146104dd578063eced028014610552578063eeaaf19d1461057e578063f4ab9adf146105af578063f851a440146105e5578063f909430314610637578063fdbc400614610649575bfe5b341561013057fe5b6101386106be565b6040518082815260200191505060405180910390f35b341561015657fe5b6101b0600480803590602001908201803590602001908080602002602001604051908101604052809392919081815260200183836020028082843782019150505050505091908035600019169060200190919050506106c4565b604051808215151515815260200191505060405180910390f35b34156101d257fe5b6101da610720565b005b34156101e457fe5b6101fe600480803560001916906020019091905050610796565b005b341561020857fe5b6102226004808035600019169060200190919050506108d4565b604051808260ff1660ff16815260200191505060405180910390f35b341561024657fe5b610260600480803560001916906020019091905050610922565b604051808215151515815260200191505060405180910390f35b341561028257fe5b6102ae600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610988565b60405180838152602001821515151581526020019250505060405180910390f35b34156102d757fe5b61032f60048080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509190803515159060200190919050506109b9565b005b341561033957fe5b610341610c26565b005b341561034b57fe5b610377600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610ef5565b604051808260ff1660ff16815260200191505060405180910390f35b341561039b57fe5b6103be600480803560001916906020019091908035906020019091905050610f15565b60405180826000191660001916815260200191505060405180910390f35b34156103e457fe5b6103fa6004808035906020019091905050610f47565b60405180826000191660001916815260200191505060405180910390f35b341561042057fe5b61043a600480803560001916906020019091905050610f6c565b604051808260ff1660ff16815260200191505060405180910390f35b341561045e57fe5b610466610f8c565b005b341561047057fe5b6104786111be565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146104ca575b8051825260208311156104ca576020820191506020810190506020830392506104a6565b5050509050019250505060405180910390f35b34156104e557fe5b6104ed611241565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461053f575b80518252602083111561053f5760208201915060208101905060208303925061051b565b5050509050019250505060405180910390f35b341561055a57fe5b610562611710565b604051808260ff1660ff16815260200191505060405180910390f35b341561058657fe5b6105ad60048080356000191690602001909190803560001916906020019091905050611728565b005b34156105b757fe5b6105e3600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061198c565b005b34156105ed57fe5b6105f5611a32565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561063f57fe5b610647611a58565b005b341561065157fe5b610659611ace565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146106ab575b8051825260208311156106ab57602082019150602081019050602083039250610687565b5050509050019250505060405180910390f35b60055481565b60006000600090505b835181101561071457826000191684828151811015156106e957fe5b906020019060200201516000191614156107065760009150610719565b5b80806001019150506106cd565b600191505b5092915050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610793576001600a60006101000a81548160ff021916908360ff1602179055505b5b565b6000600a60009054906101000a900460ff1660ff1614156108d0576000816000191614156107c3576108d1565b6107cc81610922565b156107d6576108d1565b6005600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660ff16101515610834576108d1565b600180548060010182816108489190611b31565b916000526020600020900160005b83909190915090600019169055506001600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055505b5b50565b6000600015156108e383610922565b151514156108f15760006000fd5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1690505b919050565b60006000600090505b60018054905081101561097d57826000191660018281548110151561094c57fe5b906000526020600020900160005b505460001916141561096f5760019150610982565b5b808060010191505061092b565b600091505b50919050565b60026020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b600060006002600a60009054906101000a900460ff1660ff16148015610a2c5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15610c1f57600091505b8351821015610c1e57600090505b600460008584815181101515610a5657fe5b906020019060200201516000191660001916815260200190815260200160002080549050811015610c1057610ad8600460008685815181101515610a9657fe5b906020019060200201516000191660001916815260200190815260200160002082815481101515610ac357fe5b906000526020600020900160005b5054610922565b15610b7757600160036000600460008887815181101515610af557fe5b906020019060200201516000191660001916815260200190815260200160002084815481101515610b2257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff160217905550610c02565b8215610c0157600060036000600460008887815181101515610b9557fe5b906020019060200201516000191660001916815260200190815260200160002084815481101515610bc257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060006101000a81548160ff021916908360ff1602179055505b5b5b8080600101915050610a44565b5b8180600101925050610a36565b5b5b50505050565b600060006002600a60009054906101000a900460ff1660ff161415610ef05760006001805490501415610c5857610ef1565b60016001805490501415610cba5760088054806001018281610c7a9190611b31565b916000526020600020900160005b60016000815481101515610c9857fe5b906000526020600020900160005b505490919091509060001916905550610ef1565b6003600060016000815481101515610cce57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff169150600090505b600180549050811015610eef578160036000600184815481101515610d2d57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161415610dbd5760088054806001018281610d7e9190611b31565b916000526020600020900160005b600184815481101515610d9b57fe5b906000526020600020900160005b505490919091509060001916905550610ee1565b8160036000600184815481101515610dd157fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161015610ee0576000604051805910610e1d5750595b908082528060200260200182016040525b5060089080519060200190610e44929190611b5d565b5060036000600183815481101515610e5857fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16915060088054806001018281610ea59190611b31565b916000526020600020900160005b600184815481101515610ec257fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050610d0c565b5b5b5050565b60096020528060005260406000206000915054906101000a900460ff1681565b600460205281600052604060002081815481101515610f3057fe5b906000526020600020900160005b91509150505481565b600181815481101515610f5657fe5b906000526020600020900160005b915090505481565b60036020528060005260406000206000915054906101000a900460ff1681565b600060006002600a60009054906101000a900460ff1660ff16148015610fff5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b156111b957600091505b6008805490508210156111b85760006040518059106110255750595b908082528060200260200182016040525b506006908051906020019061104c929190611b5d565b50600090505b6001805490508110156111095760088281548110151561106e57fe5b906000526020600020900160005b50546000191660018281548110151561109157fe5b906000526020600020900160005b5054600019161415156110fb57600680548060010182816110c09190611b31565b916000526020600020900160005b6001848154811015156110dd57fe5b906000526020600020900160005b5054909190915090600019169055505b5b8080600101915050611052565b60006003600060088581548110151561111e57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060006101000a81548160ff021916908360ff16021790555060068054905060405180591061116f5750595b908082528060200260200182016040525b5060019080519060200190611196929190611b5d565b50600660019080546111a9929190611bb0565b505b8180600101925050611009565b5b5b5050565b6111c6611c02565b6003600a60009054906101000a900460ff1660ff16141561123d57600780548060200260200160405190810160405280929190818152602001828054801561123157602002820191906000526020600020905b81546000191681526020019060010190808311611219575b5050505050905061123e565b5b90565b611249611c02565b6000600060006002600a60009054906101000a900460ff1660ff161480156112be5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b156117095760009250600091506000600554141561133257600180548060200260200160405190810160405280929190818152602001828054801561132657602002820191906000526020600020905b8154600019168152602001906001019080831161130e575b5050505050935061170a565b5b6001156117085760006040518059106113495750595b908082528060200260200182016040525b5060079080519060200190611370929190611b5d565b50600090505b60018054905081101561155957826003600060018481548110151561139757fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16141561142757600780548060010182816113e89190611b31565b916000526020600020900160005b60018481548110151561140557fe5b906000526020600020900160005b50549091909150906000191690555061154b565b826003600060018481548110151561143b57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16111561154a5760006040518059106114875750595b908082528060200260200182016040525b50600790805190602001906114ae929190611b5d565b50600360006001838154811015156114c257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff1692506007805480600101828161150f9190611b31565b916000526020600020900160005b60018481548110151561152c57fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050611376565b600180549050600780549050148015611570575081155b156115dd576115d460078054806020026020016040519081016040528092919081815260200182805480156115c857602002820191906000526020600020905b815460001916815260200190600101908083116115b0575b505050505060006109b9565b60019150611703565b60026005548115156115eb57fe5b048311806115fe57506002600180549050145b8061160e57506001600180549050145b806116165750815b15611693576003600a60006101000a81548160ff021916908360ff160217905550600780548060200260200160405190810160405280929190818152602001828054801561168757602002820191906000526020600020905b8154600019168152602001906001019080831161166f575b5050505050935061170a565b61169b610c26565b6116a3610f8c565b61170260088054806020026020016040519081016040528092919081815260200182805480156116f657602002820191906000526020600020905b815460001916815260200190600101908083116116de575b505050505060016109b9565b5b611333565b5b5b50505090565b6000600a60009054906101000a900460ff1690505b90565b6001600a60009054906101000a900460ff1660ff161415611987576001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415806117e15750600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff165b156117eb57611988565b600015156117f883610922565b1515148061181257506000151561180e82610922565b1515145b1561181d5760006000fd5b60016005600082825401925050819055506001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff021916908315150217905550600160036000846000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055508060001916826000191614151561192b57600460008360001916600019168152602001908152602001600020805480600101828161190e9190611b31565b916000526020600020900160005b83909190915090600019169055505b6001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055505b5b5050565b6000600a60009054906101000a900460ff1660ff161415611a2e576040604051908101604052806001815260200160001515815250600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff0219169083151502179055509050505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611acb576002600a60006101000a81548160ff021916908360ff1602179055505b5b565b611ad6611c02565b6001805480602002602001604051908101604052809291908181526020018280548015611b2657602002820191906000526020600020905b81546000191681526020019060010190808311611b0e575b505050505090505b90565b815481835581811511611b5857818360005260206000209182019101611b579190611c16565b5b505050565b828054828255906000526020600020908101928215611b9f579160200282015b82811115611b9e578251829060001916905591602001919060010190611b7d565b5b509050611bac9190611c16565b5090565b828054828255906000526020600020908101928215611bf15760005260206000209182015b82811115611bf0578254825591600101919060010190611bd5565b5b509050611bfe9190611c16565b5090565b602060405190810160405280600081525090565b611c3891905b80821115611c34576000816000905550600101611c1c565b5090565b905600a165627a7a7230582068172585dea002ea34ee2af2893bed2d97c49f18fe33ee92dd7df2e11970742d0029', 
			 gas: '4700000'
		   }, function (e, contract){
			   if (typeof contract !== 'undefined' && typeof contract.address !== 'undefined') {
					 addr = contract.address;
					 //sendAddr(addr);
					 sendParamsToServer();
					 contractInst = contract;	
					 console.log("about to set timeout");
					 setTimeout(endPhase1, regTimeDate*60000); 
				}
			
		 });
	}

}

function endPhase1() {
	displayDuringElection();
	startVoting();
	
}

function endPhase2() {
	finishVoting();

}

function storeParams() {
	question = document.getElementById('enterQuestion').value;
	
	var voterType = document.getElementById('voting-type');
	mode = voterType.options[voterType.selectedIndex].value;
	console.log(mode);
	
	var regTimeOptions = document.getElementById('reg-times');
	regTimeDate = regTimeOptions.options[regTimeOptions.selectedIndex].value;
	
	var voteTimeOptions = document.getElementById('vote-times');
	voteTimeDate = voteTimeOptions.options[voteTimeOptions.selectedIndex].value;
	
	var btn = document.getElementById("startelection-button"); 
	btn.disabled = true;
	
	//document.getElementById('enterQuestion').value = "";
}

function sendParamsToServer() {
     state = 1;
     console.log("increased state");
     console.log(state);
	var regTimeDateTmp = Date.now();
	var voteTimeDateTmp = Date.now();
	regTimeDateTmp = regTimeDateTmp + 60000*regTimeDate;
	voteTimeDateTmp = voteTimeDateTmp + 60000*(regTimeDate + voteTimeDate) + 10000;
	
	
    regTime = regTimeDateTmp
	console.log("REG-TIME");
	console.log(regTime);
    voteTime = voteTimeDateTmp

	//sendQuestion(question);
	//sendMode(mode);
	//sendRegTime(regTimeDate);
	//sendVoteTime(voteTimeDate);
	sendBatch();
	//sendAddr(addr);

	//sendState(state);
}



/**Called to start voting
*/
function startVoting(){
	//Ff contract addr set
	if (typeof addr !== 'undefined') {
		//Update front end text
		var _error = document.getElementById('errorText');
		 _error.value = "";

		console.log("Vote 5");
		var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100);
		if (mode === "Basic"){
			var ballotContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
			contractObj = ballotContract.at(addr);
			var ballot = contractObj.startVoting(
			   {
				 from: account, 
				 data: '0x6060604052341561000c57fe5b5b6000600660006101000a81548160ff021916908360ff16021790555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b610f8e8061007b6000396000f300606060405236156100e4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631ec6b60a146100e6578063230d6ed8146100f85780632f265cf71461011c578063392e66781461015a578063443019fe146101965780637b4cd5b4146101eb5780638e7ea5b21461023b578063a69beaba146102b0578063b13c744b146102d4578063c68130dc14610310578063ea35e8051461034e578063eced0280146103c3578063f4ab9adf146103ef578063f851a44014610425578063f909430314610477578063fdbc400614610489575bfe5b34156100ee57fe5b6100f66104fe565b005b341561010057fe5b61011a600480803560001916906020019091905050610574565b005b341561012457fe5b61013e6004808035600019169060200190919050506106b1565b604051808260ff1660ff16815260200191505060405180910390f35b341561016257fe5b61017c6004808035600019169060200190919050506106ff565b604051808215151515815260200191505060405180910390f35b341561019e57fe5b6101ca600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610765565b60405180838152602001821515151581526020019250505060405180910390f35b34156101f357fe5b61021f600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610796565b604051808260ff1660ff16815260200191505060405180910390f35b341561024357fe5b61024b6107b6565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461029d575b80518252602083111561029d57602082019150602081019050602083039250610279565b5050509050019250505060405180910390f35b34156102b857fe5b6102d2600480803560001916906020019091905050610839565b005b34156102dc57fe5b6102f260048080359060200190919050506109be565b60405180826000191660001916815260200191505060405180910390f35b341561031857fe5b6103326004808035600019169060200190919050506109e3565b604051808260ff1660ff16815260200191505060405180910390f35b341561035657fe5b61035e610a03565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146103b0575b8051825260208311156103b05760208201915060208101905060208303925061038c565b5050509050019250505060405180910390f35b34156103cb57fe5b6103d3610ced565b604051808260ff1660ff16815260200191505060405180910390f35b34156103f757fe5b610423600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610d05565b005b341561042d57fe5b610435610dab565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561047f57fe5b610487610dd1565b005b341561049157fe5b610499610e47565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146104eb575b8051825260208311156104eb576020820191506020810190506020830392506104c7565b5050509050019250505060405180910390f35b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610571576001600660006101000a81548160ff021916908360ff1602179055505b5b565b6000600660009054906101000a900460ff1660ff1614156106ad576000816000191614156105a1576106ae565b6105aa816106ff565b156105b4576106ae565b6005600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660ff161115610611576106ae565b600180548060010182816106259190610eaa565b916000526020600020900160005b83909190915090600019169055506001600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055505b5b50565b6000600015156106c0836106ff565b151514156106ce5760006000fd5b60046000836000191660001916815260200190815260200160002060009054906101000a900460ff1690505b919050565b60006000600090505b60018054905081101561075a57826000191660018281548110151561072957fe5b906000526020600020900160005b505460001916141561074c576001915061075f565b5b8080600101915050610708565b600091505b50919050565b60026020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b60036020528060005260406000206000915054906101000a900460ff1681565b6107be610ed6565b6003600660009054906101000a900460ff1660ff16141561083557600580548060200260200160405190810160405280929190818152602001828054801561082957602002820191906000526020600020905b81546000191681526020019060010190808311610811575b50505050509050610836565b5b90565b6001600660009054906101000a900460ff1660ff1614156109ba576001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415806108f25750600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff165b156108fc576109bb565b60001515610909826106ff565b151514156109175760006000fd5b600160046000836000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055506001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055505b5b50565b6001818154811015156109cd57fe5b906000526020600020900160005b915090505481565b60046020528060005260406000206000915054906101000a900460ff1681565b610a0b610ed6565b600060006002600660009054906101000a900460ff1660ff16148015610a7e5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15610ce75760009150600090505b600180549050811015610c6f578160046000600184815481101515610aad57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161415610b3d5760058054806001018281610afe9190610eaa565b916000526020600020900160005b600184815481101515610b1b57fe5b906000526020600020900160005b505490919091509060001916905550610c61565b8160046000600184815481101515610b5157fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161115610c60576000604051805910610b9d5750595b908082528060200260200182016040525b5060059080519060200190610bc4929190610eea565b5060046000600183815481101515610bd857fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16915060058054806001018281610c259190610eaa565b916000526020600020900160005b600184815481101515610c4257fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050610a8c565b6003600660006101000a81548160ff021916908360ff1602179055506005805480602002602001604051908101604052809291908181526020018280548015610cdb57602002820191906000526020600020905b81546000191681526020019060010190808311610cc3575b50505050509250610ce8565b5b505090565b6000600660009054906101000a900460ff1690505b90565b6000600660009054906101000a900460ff1660ff161415610da7576040604051908101604052806001815260200160001515815250600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff0219169083151502179055509050505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610e44576002600660006101000a81548160ff021916908360ff1602179055505b5b565b610e4f610ed6565b6001805480602002602001604051908101604052809291908181526020018280548015610e9f57602002820191906000526020600020905b81546000191681526020019060010190808311610e87575b505050505090505b90565b815481835581811511610ed157818360005260206000209182019101610ed09190610f3d565b5b505050565b602060405190810160405280600081525090565b828054828255906000526020600020908101928215610f2c579160200282015b82811115610f2b578251829060001916905591602001919060010190610f0a565b5b509050610f399190610f3d565b5090565b610f5f91905b80821115610f5b576000816000905550600101610f43565b5090565b905600a165627a7a72305820ff1f3584d009c341f728a176ff8df8a80b976183f7e150e6e13f3100ccbd10d40029', 
				 gas: '4700000'
			   }, function (e, contract){
				if (e){
					console.log(e);
					_error.innerHTML = e;
				}
				else if (typeof contract !== 'undefined') {
					 //console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
					 _error.value = "Voting initiated.";
					 displayDuringElection();
					 getCandidateList();
					state = 2;
					sendState(state);
					setTimeout(endPhase2, voteTimeDate*60000 + 10000);
				}
			 });
		} if (mode === "Preferential"){
			var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
			contractObj = ballotContract.at(addr);
			var ballot = contractObj.startVoting(
			   {
				 from: account, 
				 data: '0x6060604052341561000c57fe5b5b60006005819055506000600a60006101000a81548160ff021916908360ff16021790555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b611c67806100836000396000f30060606040523615610126576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630d15fd77146101285780631b2a87151461014e5780631ec6b60a146101ca578063230d6ed8146101dc5780632f265cf714610200578063392e66781461023e578063443019fe1461027a5780634e9384da146102cf5780636ace7d87146103315780637b4cd5b4146103435780638244b42f14610393578063b13c744b146103dc578063c68130dc14610418578063dd7bff8214610456578063df15c37e14610468578063ea35e805146104dd578063eced028014610552578063eeaaf19d1461057e578063f4ab9adf146105af578063f851a440146105e5578063f909430314610637578063fdbc400614610649575bfe5b341561013057fe5b6101386106be565b6040518082815260200191505060405180910390f35b341561015657fe5b6101b0600480803590602001908201803590602001908080602002602001604051908101604052809392919081815260200183836020028082843782019150505050505091908035600019169060200190919050506106c4565b604051808215151515815260200191505060405180910390f35b34156101d257fe5b6101da610720565b005b34156101e457fe5b6101fe600480803560001916906020019091905050610796565b005b341561020857fe5b6102226004808035600019169060200190919050506108d4565b604051808260ff1660ff16815260200191505060405180910390f35b341561024657fe5b610260600480803560001916906020019091905050610922565b604051808215151515815260200191505060405180910390f35b341561028257fe5b6102ae600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610988565b60405180838152602001821515151581526020019250505060405180910390f35b34156102d757fe5b61032f60048080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509190803515159060200190919050506109b9565b005b341561033957fe5b610341610c26565b005b341561034b57fe5b610377600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610ef5565b604051808260ff1660ff16815260200191505060405180910390f35b341561039b57fe5b6103be600480803560001916906020019091908035906020019091905050610f15565b60405180826000191660001916815260200191505060405180910390f35b34156103e457fe5b6103fa6004808035906020019091905050610f47565b60405180826000191660001916815260200191505060405180910390f35b341561042057fe5b61043a600480803560001916906020019091905050610f6c565b604051808260ff1660ff16815260200191505060405180910390f35b341561045e57fe5b610466610f8c565b005b341561047057fe5b6104786111be565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146104ca575b8051825260208311156104ca576020820191506020810190506020830392506104a6565b5050509050019250505060405180910390f35b34156104e557fe5b6104ed611241565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461053f575b80518252602083111561053f5760208201915060208101905060208303925061051b565b5050509050019250505060405180910390f35b341561055a57fe5b610562611710565b604051808260ff1660ff16815260200191505060405180910390f35b341561058657fe5b6105ad60048080356000191690602001909190803560001916906020019091905050611728565b005b34156105b757fe5b6105e3600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061198c565b005b34156105ed57fe5b6105f5611a32565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561063f57fe5b610647611a58565b005b341561065157fe5b610659611ace565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146106ab575b8051825260208311156106ab57602082019150602081019050602083039250610687565b5050509050019250505060405180910390f35b60055481565b60006000600090505b835181101561071457826000191684828151811015156106e957fe5b906020019060200201516000191614156107065760009150610719565b5b80806001019150506106cd565b600191505b5092915050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610793576001600a60006101000a81548160ff021916908360ff1602179055505b5b565b6000600a60009054906101000a900460ff1660ff1614156108d0576000816000191614156107c3576108d1565b6107cc81610922565b156107d6576108d1565b6005600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660ff16101515610834576108d1565b600180548060010182816108489190611b31565b916000526020600020900160005b83909190915090600019169055506001600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055505b5b50565b6000600015156108e383610922565b151514156108f15760006000fd5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1690505b919050565b60006000600090505b60018054905081101561097d57826000191660018281548110151561094c57fe5b906000526020600020900160005b505460001916141561096f5760019150610982565b5b808060010191505061092b565b600091505b50919050565b60026020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b600060006002600a60009054906101000a900460ff1660ff16148015610a2c5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15610c1f57600091505b8351821015610c1e57600090505b600460008584815181101515610a5657fe5b906020019060200201516000191660001916815260200190815260200160002080549050811015610c1057610ad8600460008685815181101515610a9657fe5b906020019060200201516000191660001916815260200190815260200160002082815481101515610ac357fe5b906000526020600020900160005b5054610922565b15610b7757600160036000600460008887815181101515610af557fe5b906020019060200201516000191660001916815260200190815260200160002084815481101515610b2257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff160217905550610c02565b8215610c0157600060036000600460008887815181101515610b9557fe5b906020019060200201516000191660001916815260200190815260200160002084815481101515610bc257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060006101000a81548160ff021916908360ff1602179055505b5b5b8080600101915050610a44565b5b8180600101925050610a36565b5b5b50505050565b600060006002600a60009054906101000a900460ff1660ff161415610ef05760006001805490501415610c5857610ef1565b60016001805490501415610cba5760088054806001018281610c7a9190611b31565b916000526020600020900160005b60016000815481101515610c9857fe5b906000526020600020900160005b505490919091509060001916905550610ef1565b6003600060016000815481101515610cce57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff169150600090505b600180549050811015610eef578160036000600184815481101515610d2d57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161415610dbd5760088054806001018281610d7e9190611b31565b916000526020600020900160005b600184815481101515610d9b57fe5b906000526020600020900160005b505490919091509060001916905550610ee1565b8160036000600184815481101515610dd157fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161015610ee0576000604051805910610e1d5750595b908082528060200260200182016040525b5060089080519060200190610e44929190611b5d565b5060036000600183815481101515610e5857fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16915060088054806001018281610ea59190611b31565b916000526020600020900160005b600184815481101515610ec257fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050610d0c565b5b5b5050565b60096020528060005260406000206000915054906101000a900460ff1681565b600460205281600052604060002081815481101515610f3057fe5b906000526020600020900160005b91509150505481565b600181815481101515610f5657fe5b906000526020600020900160005b915090505481565b60036020528060005260406000206000915054906101000a900460ff1681565b600060006002600a60009054906101000a900460ff1660ff16148015610fff5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b156111b957600091505b6008805490508210156111b85760006040518059106110255750595b908082528060200260200182016040525b506006908051906020019061104c929190611b5d565b50600090505b6001805490508110156111095760088281548110151561106e57fe5b906000526020600020900160005b50546000191660018281548110151561109157fe5b906000526020600020900160005b5054600019161415156110fb57600680548060010182816110c09190611b31565b916000526020600020900160005b6001848154811015156110dd57fe5b906000526020600020900160005b5054909190915090600019169055505b5b8080600101915050611052565b60006003600060088581548110151561111e57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060006101000a81548160ff021916908360ff16021790555060068054905060405180591061116f5750595b908082528060200260200182016040525b5060019080519060200190611196929190611b5d565b50600660019080546111a9929190611bb0565b505b8180600101925050611009565b5b5b5050565b6111c6611c02565b6003600a60009054906101000a900460ff1660ff16141561123d57600780548060200260200160405190810160405280929190818152602001828054801561123157602002820191906000526020600020905b81546000191681526020019060010190808311611219575b5050505050905061123e565b5b90565b611249611c02565b6000600060006002600a60009054906101000a900460ff1660ff161480156112be5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b156117095760009250600091506000600554141561133257600180548060200260200160405190810160405280929190818152602001828054801561132657602002820191906000526020600020905b8154600019168152602001906001019080831161130e575b5050505050935061170a565b5b6001156117085760006040518059106113495750595b908082528060200260200182016040525b5060079080519060200190611370929190611b5d565b50600090505b60018054905081101561155957826003600060018481548110151561139757fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16141561142757600780548060010182816113e89190611b31565b916000526020600020900160005b60018481548110151561140557fe5b906000526020600020900160005b50549091909150906000191690555061154b565b826003600060018481548110151561143b57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16111561154a5760006040518059106114875750595b908082528060200260200182016040525b50600790805190602001906114ae929190611b5d565b50600360006001838154811015156114c257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff1692506007805480600101828161150f9190611b31565b916000526020600020900160005b60018481548110151561152c57fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050611376565b600180549050600780549050148015611570575081155b156115dd576115d460078054806020026020016040519081016040528092919081815260200182805480156115c857602002820191906000526020600020905b815460001916815260200190600101908083116115b0575b505050505060006109b9565b60019150611703565b60026005548115156115eb57fe5b048311806115fe57506002600180549050145b8061160e57506001600180549050145b806116165750815b15611693576003600a60006101000a81548160ff021916908360ff160217905550600780548060200260200160405190810160405280929190818152602001828054801561168757602002820191906000526020600020905b8154600019168152602001906001019080831161166f575b5050505050935061170a565b61169b610c26565b6116a3610f8c565b61170260088054806020026020016040519081016040528092919081815260200182805480156116f657602002820191906000526020600020905b815460001916815260200190600101908083116116de575b505050505060016109b9565b5b611333565b5b5b50505090565b6000600a60009054906101000a900460ff1690505b90565b6001600a60009054906101000a900460ff1660ff161415611987576001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415806117e15750600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff165b156117eb57611988565b600015156117f883610922565b1515148061181257506000151561180e82610922565b1515145b1561181d5760006000fd5b60016005600082825401925050819055506001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff021916908315150217905550600160036000846000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055508060001916826000191614151561192b57600460008360001916600019168152602001908152602001600020805480600101828161190e9190611b31565b916000526020600020900160005b83909190915090600019169055505b6001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055505b5b5050565b6000600a60009054906101000a900460ff1660ff161415611a2e576040604051908101604052806001815260200160001515815250600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff0219169083151502179055509050505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611acb576002600a60006101000a81548160ff021916908360ff1602179055505b5b565b611ad6611c02565b6001805480602002602001604051908101604052809291908181526020018280548015611b2657602002820191906000526020600020905b81546000191681526020019060010190808311611b0e575b505050505090505b90565b815481835581811511611b5857818360005260206000209182019101611b579190611c16565b5b505050565b828054828255906000526020600020908101928215611b9f579160200282015b82811115611b9e578251829060001916905591602001919060010190611b7d565b5b509050611bac9190611c16565b5090565b828054828255906000526020600020908101928215611bf15760005260206000209182015b82811115611bf0578254825591600101919060010190611bd5565b5b509050611bfe9190611c16565b5090565b602060405190810160405280600081525090565b611c3891905b80821115611c34576000816000905550600101611c1c565b5090565b905600a165627a7a7230582068172585dea002ea34ee2af2893bed2d97c49f18fe33ee92dd7df2e11970742d0029', 
				 gas: '4700000'
			   }, function (e, contract){
				if (e){
					console.log(e);
					_error.innerHTML = e;
				}
				else if (typeof contract !== 'undefined') {
					 //console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
					 _error.value = "Voting initiated.";
					 displayDuringElection();
					 state = 2;
					 sendState(state);
					 setTimeout(endPhase2, voteTimeDate*60000 + 10000);
				}
			 });
		}
	} else {
		//Update front end text if contract addr not set
		var _error = document.getElementById('errorText');
		 _error.innerHTML = "Contract Address not Set.";
	}
}

/**Called to start voting
*/
function finishVoting(){
	//Ff contract addr set
	if (typeof addr !== 'undefined') {
		//Update front end text
		var _error = document.getElementById('errorText');
		 _error.value = "";

		var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100);
		if(mode === "Basic"){
			var ballotContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
			contractObj = ballotContract.at(addr);
			var ballot = contractObj.finishVoting(
			   {
				 from: account, 
				 data: '0x6060604052341561000c57fe5b5b6000600660006101000a81548160ff021916908360ff16021790555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b610f8e8061007b6000396000f300606060405236156100e4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631ec6b60a146100e6578063230d6ed8146100f85780632f265cf71461011c578063392e66781461015a578063443019fe146101965780637b4cd5b4146101eb5780638e7ea5b21461023b578063a69beaba146102b0578063b13c744b146102d4578063c68130dc14610310578063ea35e8051461034e578063eced0280146103c3578063f4ab9adf146103ef578063f851a44014610425578063f909430314610477578063fdbc400614610489575bfe5b34156100ee57fe5b6100f66104fe565b005b341561010057fe5b61011a600480803560001916906020019091905050610574565b005b341561012457fe5b61013e6004808035600019169060200190919050506106b1565b604051808260ff1660ff16815260200191505060405180910390f35b341561016257fe5b61017c6004808035600019169060200190919050506106ff565b604051808215151515815260200191505060405180910390f35b341561019e57fe5b6101ca600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610765565b60405180838152602001821515151581526020019250505060405180910390f35b34156101f357fe5b61021f600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610796565b604051808260ff1660ff16815260200191505060405180910390f35b341561024357fe5b61024b6107b6565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461029d575b80518252602083111561029d57602082019150602081019050602083039250610279565b5050509050019250505060405180910390f35b34156102b857fe5b6102d2600480803560001916906020019091905050610839565b005b34156102dc57fe5b6102f260048080359060200190919050506109be565b60405180826000191660001916815260200191505060405180910390f35b341561031857fe5b6103326004808035600019169060200190919050506109e3565b604051808260ff1660ff16815260200191505060405180910390f35b341561035657fe5b61035e610a03565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146103b0575b8051825260208311156103b05760208201915060208101905060208303925061038c565b5050509050019250505060405180910390f35b34156103cb57fe5b6103d3610ced565b604051808260ff1660ff16815260200191505060405180910390f35b34156103f757fe5b610423600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610d05565b005b341561042d57fe5b610435610dab565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561047f57fe5b610487610dd1565b005b341561049157fe5b610499610e47565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146104eb575b8051825260208311156104eb576020820191506020810190506020830392506104c7565b5050509050019250505060405180910390f35b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610571576001600660006101000a81548160ff021916908360ff1602179055505b5b565b6000600660009054906101000a900460ff1660ff1614156106ad576000816000191614156105a1576106ae565b6105aa816106ff565b156105b4576106ae565b6005600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660ff161115610611576106ae565b600180548060010182816106259190610eaa565b916000526020600020900160005b83909190915090600019169055506001600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055505b5b50565b6000600015156106c0836106ff565b151514156106ce5760006000fd5b60046000836000191660001916815260200190815260200160002060009054906101000a900460ff1690505b919050565b60006000600090505b60018054905081101561075a57826000191660018281548110151561072957fe5b906000526020600020900160005b505460001916141561074c576001915061075f565b5b8080600101915050610708565b600091505b50919050565b60026020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b60036020528060005260406000206000915054906101000a900460ff1681565b6107be610ed6565b6003600660009054906101000a900460ff1660ff16141561083557600580548060200260200160405190810160405280929190818152602001828054801561082957602002820191906000526020600020905b81546000191681526020019060010190808311610811575b50505050509050610836565b5b90565b6001600660009054906101000a900460ff1660ff1614156109ba576001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415806108f25750600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff165b156108fc576109bb565b60001515610909826106ff565b151514156109175760006000fd5b600160046000836000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055506001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055505b5b50565b6001818154811015156109cd57fe5b906000526020600020900160005b915090505481565b60046020528060005260406000206000915054906101000a900460ff1681565b610a0b610ed6565b600060006002600660009054906101000a900460ff1660ff16148015610a7e5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15610ce75760009150600090505b600180549050811015610c6f578160046000600184815481101515610aad57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161415610b3d5760058054806001018281610afe9190610eaa565b916000526020600020900160005b600184815481101515610b1b57fe5b906000526020600020900160005b505490919091509060001916905550610c61565b8160046000600184815481101515610b5157fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161115610c60576000604051805910610b9d5750595b908082528060200260200182016040525b5060059080519060200190610bc4929190610eea565b5060046000600183815481101515610bd857fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16915060058054806001018281610c259190610eaa565b916000526020600020900160005b600184815481101515610c4257fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050610a8c565b6003600660006101000a81548160ff021916908360ff1602179055506005805480602002602001604051908101604052809291908181526020018280548015610cdb57602002820191906000526020600020905b81546000191681526020019060010190808311610cc3575b50505050509250610ce8565b5b505090565b6000600660009054906101000a900460ff1690505b90565b6000600660009054906101000a900460ff1660ff161415610da7576040604051908101604052806001815260200160001515815250600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff0219169083151502179055509050505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610e44576002600660006101000a81548160ff021916908360ff1602179055505b5b565b610e4f610ed6565b6001805480602002602001604051908101604052809291908181526020018280548015610e9f57602002820191906000526020600020905b81546000191681526020019060010190808311610e87575b505050505090505b90565b815481835581811511610ed157818360005260206000209182019101610ed09190610f3d565b5b505050565b602060405190810160405280600081525090565b828054828255906000526020600020908101928215610f2c579160200282015b82811115610f2b578251829060001916905591602001919060010190610f0a565b5b509050610f399190610f3d565b5090565b610f5f91905b80821115610f5b576000816000905550600101610f43565b5090565b905600a165627a7a72305820ff1f3584d009c341f728a176ff8df8a80b976183f7e150e6e13f3100ccbd10d40029', 
				 gas: '4700000'
			   }, function (e, contract){
				if (e){
					console.log(e);
					_error.innerHTML = e;
				}
				else if (typeof contract !== 'undefined') {
					 //console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
					 _error.value = "Voting finished.";
						calculateWinner();

						displayPostElection();
				}
			 });
			
		} if (mode === "Preferential"){
			var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
			contractObj = ballotContract.at(addr);
			var ballot = contractObj.finishVoting(
			   {
				 from: account, 
				 data: '0x6060604052341561000c57fe5b5b60006005819055506000600a60006101000a81548160ff021916908360ff16021790555033600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b611c67806100836000396000f30060606040523615610126576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630d15fd77146101285780631b2a87151461014e5780631ec6b60a146101ca578063230d6ed8146101dc5780632f265cf714610200578063392e66781461023e578063443019fe1461027a5780634e9384da146102cf5780636ace7d87146103315780637b4cd5b4146103435780638244b42f14610393578063b13c744b146103dc578063c68130dc14610418578063dd7bff8214610456578063df15c37e14610468578063ea35e805146104dd578063eced028014610552578063eeaaf19d1461057e578063f4ab9adf146105af578063f851a440146105e5578063f909430314610637578063fdbc400614610649575bfe5b341561013057fe5b6101386106be565b6040518082815260200191505060405180910390f35b341561015657fe5b6101b0600480803590602001908201803590602001908080602002602001604051908101604052809392919081815260200183836020028082843782019150505050505091908035600019169060200190919050506106c4565b604051808215151515815260200191505060405180910390f35b34156101d257fe5b6101da610720565b005b34156101e457fe5b6101fe600480803560001916906020019091905050610796565b005b341561020857fe5b6102226004808035600019169060200190919050506108d4565b604051808260ff1660ff16815260200191505060405180910390f35b341561024657fe5b610260600480803560001916906020019091905050610922565b604051808215151515815260200191505060405180910390f35b341561028257fe5b6102ae600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610988565b60405180838152602001821515151581526020019250505060405180910390f35b34156102d757fe5b61032f60048080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509190803515159060200190919050506109b9565b005b341561033957fe5b610341610c26565b005b341561034b57fe5b610377600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610ef5565b604051808260ff1660ff16815260200191505060405180910390f35b341561039b57fe5b6103be600480803560001916906020019091908035906020019091905050610f15565b60405180826000191660001916815260200191505060405180910390f35b34156103e457fe5b6103fa6004808035906020019091905050610f47565b60405180826000191660001916815260200191505060405180910390f35b341561042057fe5b61043a600480803560001916906020019091905050610f6c565b604051808260ff1660ff16815260200191505060405180910390f35b341561045e57fe5b610466610f8c565b005b341561047057fe5b6104786111be565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146104ca575b8051825260208311156104ca576020820191506020810190506020830392506104a6565b5050509050019250505060405180910390f35b34156104e557fe5b6104ed611241565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461053f575b80518252602083111561053f5760208201915060208101905060208303925061051b565b5050509050019250505060405180910390f35b341561055a57fe5b610562611710565b604051808260ff1660ff16815260200191505060405180910390f35b341561058657fe5b6105ad60048080356000191690602001909190803560001916906020019091905050611728565b005b34156105b757fe5b6105e3600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061198c565b005b34156105ed57fe5b6105f5611a32565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561063f57fe5b610647611a58565b005b341561065157fe5b610659611ace565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146106ab575b8051825260208311156106ab57602082019150602081019050602083039250610687565b5050509050019250505060405180910390f35b60055481565b60006000600090505b835181101561071457826000191684828151811015156106e957fe5b906020019060200201516000191614156107065760009150610719565b5b80806001019150506106cd565b600191505b5092915050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610793576001600a60006101000a81548160ff021916908360ff1602179055505b5b565b6000600a60009054906101000a900460ff1660ff1614156108d0576000816000191614156107c3576108d1565b6107cc81610922565b156107d6576108d1565b6005600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1660ff16101515610834576108d1565b600180548060010182816108489190611b31565b916000526020600020900160005b83909190915090600019169055506001600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055505b5b50565b6000600015156108e383610922565b151514156108f15760006000fd5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1690505b919050565b60006000600090505b60018054905081101561097d57826000191660018281548110151561094c57fe5b906000526020600020900160005b505460001916141561096f5760019150610982565b5b808060010191505061092b565b600091505b50919050565b60026020528060005260406000206000915090508060000154908060010160009054906101000a900460ff16905082565b600060006002600a60009054906101000a900460ff1660ff16148015610a2c5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15610c1f57600091505b8351821015610c1e57600090505b600460008584815181101515610a5657fe5b906020019060200201516000191660001916815260200190815260200160002080549050811015610c1057610ad8600460008685815181101515610a9657fe5b906020019060200201516000191660001916815260200190815260200160002082815481101515610ac357fe5b906000526020600020900160005b5054610922565b15610b7757600160036000600460008887815181101515610af557fe5b906020019060200201516000191660001916815260200190815260200160002084815481101515610b2257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff160217905550610c02565b8215610c0157600060036000600460008887815181101515610b9557fe5b906020019060200201516000191660001916815260200190815260200160002084815481101515610bc257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060006101000a81548160ff021916908360ff1602179055505b5b5b8080600101915050610a44565b5b8180600101925050610a36565b5b5b50505050565b600060006002600a60009054906101000a900460ff1660ff161415610ef05760006001805490501415610c5857610ef1565b60016001805490501415610cba5760088054806001018281610c7a9190611b31565b916000526020600020900160005b60016000815481101515610c9857fe5b906000526020600020900160005b505490919091509060001916905550610ef1565b6003600060016000815481101515610cce57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff169150600090505b600180549050811015610eef578160036000600184815481101515610d2d57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161415610dbd5760088054806001018281610d7e9190611b31565b916000526020600020900160005b600184815481101515610d9b57fe5b906000526020600020900160005b505490919091509060001916905550610ee1565b8160036000600184815481101515610dd157fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff161015610ee0576000604051805910610e1d5750595b908082528060200260200182016040525b5060089080519060200190610e44929190611b5d565b5060036000600183815481101515610e5857fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16915060088054806001018281610ea59190611b31565b916000526020600020900160005b600184815481101515610ec257fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050610d0c565b5b5b5050565b60096020528060005260406000206000915054906101000a900460ff1681565b600460205281600052604060002081815481101515610f3057fe5b906000526020600020900160005b91509150505481565b600181815481101515610f5657fe5b906000526020600020900160005b915090505481565b60036020528060005260406000206000915054906101000a900460ff1681565b600060006002600a60009054906101000a900460ff1660ff16148015610fff5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b156111b957600091505b6008805490508210156111b85760006040518059106110255750595b908082528060200260200182016040525b506006908051906020019061104c929190611b5d565b50600090505b6001805490508110156111095760088281548110151561106e57fe5b906000526020600020900160005b50546000191660018281548110151561109157fe5b906000526020600020900160005b5054600019161415156110fb57600680548060010182816110c09190611b31565b916000526020600020900160005b6001848154811015156110dd57fe5b906000526020600020900160005b5054909190915090600019169055505b5b8080600101915050611052565b60006003600060088581548110151561111e57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060006101000a81548160ff021916908360ff16021790555060068054905060405180591061116f5750595b908082528060200260200182016040525b5060019080519060200190611196929190611b5d565b50600660019080546111a9929190611bb0565b505b8180600101925050611009565b5b5b5050565b6111c6611c02565b6003600a60009054906101000a900460ff1660ff16141561123d57600780548060200260200160405190810160405280929190818152602001828054801561123157602002820191906000526020600020905b81546000191681526020019060010190808311611219575b5050505050905061123e565b5b90565b611249611c02565b6000600060006002600a60009054906101000a900460ff1660ff161480156112be5750600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b156117095760009250600091506000600554141561133257600180548060200260200160405190810160405280929190818152602001828054801561132657602002820191906000526020600020905b8154600019168152602001906001019080831161130e575b5050505050935061170a565b5b6001156117085760006040518059106113495750595b908082528060200260200182016040525b5060079080519060200190611370929190611b5d565b50600090505b60018054905081101561155957826003600060018481548110151561139757fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16141561142757600780548060010182816113e89190611b31565b916000526020600020900160005b60018481548110151561140557fe5b906000526020600020900160005b50549091909150906000191690555061154b565b826003600060018481548110151561143b57fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff16111561154a5760006040518059106114875750595b908082528060200260200182016040525b50600790805190602001906114ae929190611b5d565b50600360006001838154811015156114c257fe5b906000526020600020900160005b50546000191660001916815260200190815260200160002060009054906101000a900460ff1660ff1692506007805480600101828161150f9190611b31565b916000526020600020900160005b60018481548110151561152c57fe5b906000526020600020900160005b5054909190915090600019169055505b5b5b8080600101915050611376565b600180549050600780549050148015611570575081155b156115dd576115d460078054806020026020016040519081016040528092919081815260200182805480156115c857602002820191906000526020600020905b815460001916815260200190600101908083116115b0575b505050505060006109b9565b60019150611703565b60026005548115156115eb57fe5b048311806115fe57506002600180549050145b8061160e57506001600180549050145b806116165750815b15611693576003600a60006101000a81548160ff021916908360ff160217905550600780548060200260200160405190810160405280929190818152602001828054801561168757602002820191906000526020600020905b8154600019168152602001906001019080831161166f575b5050505050935061170a565b61169b610c26565b6116a3610f8c565b61170260088054806020026020016040519081016040528092919081815260200182805480156116f657602002820191906000526020600020905b815460001916815260200190600101908083116116de575b505050505060016109b9565b5b611333565b5b5b50505090565b6000600a60009054906101000a900460ff1690505b90565b6001600a60009054906101000a900460ff1660ff161415611987576001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415806117e15750600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff165b156117eb57611988565b600015156117f883610922565b1515148061181257506000151561180e82610922565b1515145b1561181d5760006000fd5b60016005600082825401925050819055506001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff021916908315150217905550600160036000846000191660001916815260200190815260200160002060008282829054906101000a900460ff160192506101000a81548160ff021916908360ff1602179055508060001916826000191614151561192b57600460008360001916600019168152602001908152602001600020805480600101828161190e9190611b31565b916000526020600020900160005b83909190915090600019169055505b6001600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff0219169083151502179055505b5b5050565b6000600a60009054906101000a900460ff1660ff161415611a2e576040604051908101604052806001815260200160001515815250600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548160ff0219169083151502179055509050505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611acb576002600a60006101000a81548160ff021916908360ff1602179055505b5b565b611ad6611c02565b6001805480602002602001604051908101604052809291908181526020018280548015611b2657602002820191906000526020600020905b81546000191681526020019060010190808311611b0e575b505050505090505b90565b815481835581811511611b5857818360005260206000209182019101611b579190611c16565b5b505050565b828054828255906000526020600020908101928215611b9f579160200282015b82811115611b9e578251829060001916905591602001919060010190611b7d565b5b509050611bac9190611c16565b5090565b828054828255906000526020600020908101928215611bf15760005260206000209182015b82811115611bf0578254825591600101919060010190611bd5565b5b509050611bfe9190611c16565b5090565b602060405190810160405280600081525090565b611c3891905b80821115611c34576000816000905550600101611c1c565b5090565b905600a165627a7a7230582068172585dea002ea34ee2af2893bed2d97c49f18fe33ee92dd7df2e11970742d0029', 
				 gas: '4700000'
			   }, function (e, contract){
				if (e){
					console.log(e);
					_error.innerHTML = e;
				}
				else if (typeof contract !== 'undefined'){
					 //console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
						calculateWinner();
					 _error.value = "Voting finished.";
					  displayPostElection();
				}
			 });
		}
	} else {
		//Update front end text if contract addr not set
		var _error = document.getElementById('errorText');
		 _error.innerHTML = "Contract Address not Set.";
	}
}


function getStateFromServer() {
	  var xhttp; 
	  xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
				state = this.responseText;
				//Process state object if needed
				console.log(state);
				/*
				if (!state){
						console.log("State not yet set.");
						state = 0;
					} else {
						console.log(state);
					}*/
					
	if (state == 0) {
		displayPreElection();
	} else if (state == 1 || state == 2) {
		displayDuringElection();
	} else if (state == 3) {
		displayPostElection();
	}
		}
	  };
	  xhttp.open("GET", "getState.php", true);
	  xhttp.send();
	}

function getPhase(){
	//If contract addr set
	if (typeof addr !== 'undefined') {
		//Set front end error text to empty
		var _error = document.getElementById('errorText');
		 _error.innerHTML = "";
		 
		//Keep user logged in
		var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100); 
		 
		 if (mode === "Basic"){
			//Our contract ABI
			var ballotContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			//Call winning proposal
			res = contractObj.getPhase.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								state = hex2S(l);
								console.log("Phase is " + state );
								sendState(state);
							}
						 });
		 } if (mode === "Preferential"){
			//Our contract ABI
			var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			//Call winning proposal
			res = contractObj.getPhase.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								state = hex2S(l);
								console.log("Phase is " + state );
								sendState(state);
							}
						 });
		 }
	} else {
			var _error = document.getElementById('errorText');
			 _error.innerHTML = "Contract address not set.";
	}
}

function getCandidateList(){
	//If contract addr set
	if (typeof addr !== 'undefined') {
		//Set front end error text to empty
		var _error = document.getElementById('errorText');
		 _error.innerHTML = "";
		 
		//Keep user logged in
		var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100); 
		 
		if (mode === "Basic"){
			//Our contract ABI
			var ballotContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			//Call winning proposal
			res = contractObj.getCandidateList.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								candidateList = hex2S(l);
								console.log("Candidate list is " + l );
								//sendState(state);
							}
						 });
			
		}
		if(mode === "Preferential"){
			//Our contract ABI
			var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			//Call winning proposal
			res = contractObj.getCandidateList.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								candidateList = hex2S(l);
								console.log("Candidate list is " + l );
								//sendState(state);
							}
						 });
		}
	} else {
			var _error = document.getElementById('errorText');
			 _error.innerHTML = "Contract address not set.";
	}
}

function calculateWinner(){
	//If contract addr set
	if (typeof addr !== 'undefined') {
		//Set front end error text to empty
		var _error = document.getElementById('errorText');
		 _error.innerHTML = "";
		 
		//Keep user logged in
		var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100); 
		 
		 if (mode === "Basic"){
			//Our contract ABI
			var ballotContract =  web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			
			//Call winning proposal
			res = contractObj.calculateWinner.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
							     //winners = hex2S(l);
								state = 3;
								sendState(state);
								console.log("Calculating winner.");
								getWinner();
							}
						 });
		 } if (mode === "Preferential"){
			//Our contract ABI
			var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			
			//Call winning proposal
			res = contractObj.calculateWinner.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								//winners = hex2S(l);
								state = 3;
								sendState(state);
								console.log("Calculating winner.");
								getWinner()
							}
						 });
		 }
		
	} else {
			var _error = document.getElementById('errorText');
			 _error.innerHTML = "Contract address not set.";
	}
	//var ballot = ballotContract.giveRightToVote();
	

}


function getWinner(){
	//If contract addr set
	if (typeof addr !== 'undefined') {
		//Set front end error text to empty
		var _error = document.getElementById('errorText');
		 _error.innerHTML = "";
		 
		//Keep user logged in
		var account = web3.eth.accounts[0];
		var accountInterval = setInterval(function() {
		  if (web3.eth.accounts[0] !== account) {
			account = web3.eth.accounts[0];
		  }
		}, 100); 
		 
		 if (mode === "Basic"){
			//Our contract ABI
			var ballotContract =  web3.eth.contract([{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			
			//Call winning proposal
			res = contractObj.getWinner.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								console.log("l is " + l);
								winners = hex2SArray(l);
								console.log("Winning proposal is " + winners);
								sendWinner(winners);
							}
							else {
								console.log(e);
							}
						 });
		 } if (mode === "Preferential"){
			//Our contract ABI
			var ballotContract =  web3.eth.contract([{"constant":true,"inputs":[],"name":"totalVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"excludeList","type":"bytes32[]"},{"name":"candidateName","type":"bytes32"}],"name":"notIn","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"startVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"addCandidate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"votersList","outputs":[{"name":"weight","type":"uint256"},{"name":"voted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"candidates","type":"bytes32[]"},{"name":"shouldDelete","type":"bool"}],"name":"addSecondPreferences","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getLastCandidates","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"candidateSubmissionNumbers","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"secondPreferences","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesForCandidates","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"removeCandidates","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getWinners","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"calculateWinner","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getPhase","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"firstPreference","type":"bytes32"},{"name":"secondPreference","type":"bytes32"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"addVoter","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishVoting","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getCandidateList","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);

			//Point at our contract addr
			contractObj = ballotContract.at(addr);
			
			
			//Call winning proposal
			res = contractObj.getWinner.call({ from: account, gas: 4200000}, function(e,l){
							if (!e){
								console.log("l is " + l);
								winners =  hex2SArray(l);
								console.log("Winning proposal is " + winners);
								sendWinner(winners);
							}
							else {
								console.log(e);
							}
						 });
		 }
		
	} else {
			var _error = document.getElementById('errorText');
			 _error.innerHTML = "Contract address not set.";
	}
	//var ballot = ballotContract.giveRightToVote();
	

}

function sendAjax(str, type){
  var xhttp; 
  xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
		console.log(str+" sent.");
		console.log(this.responseText);
    }
  };
  switch(type){
	  case "addr":
		xhttp.open("GET", "sendAddr.php?str="+str, true);
		break;
	  case "regTime":
		xhttp.open("GET", "sendRegTime.php?str="+str, true);
		break;
	  case "voteTime":
		xhttp.open("GET", "sendVoteTime.php?str="+str, true);
		break;
	  case "state":
	    xhttp.open("GET", "sendState.php?str="+str, true);
		break;
	  case "mode":
	    xhttp.open("GET", "sendMode.php?str="+str, true);
		break;
	  case "question":
	    xhttp.open("GET", "sendQuestion.php?str="+str, true);
		break;
	  case "winner":
	    xhttp.open("GET", "sendWinner.php?str="+str, true);
		break;
	  case "batch":
	    xhttp.open("GET", "sendBatch.php?addr="+addr+"&regTime="+regTime+"&voteTime="+voteTime+"&state="+state+"&mode="+mode+"&question="+question, true);
		break;
	  default:
		break;
  }
  xhttp.send();
}

function sendBatch() {
	sendAjax("Batch", "batch");
}

function sendAddr(str) {
	sendAjax(str, "addr");
}

function sendVoteTime(str) {
	sendAjax(str, "voteTime");
}

function sendMode(str) {
	sendAjax(str, "mode");
}

function sendQuestion(str) {
	sendAjax(str, "question");
}


function sendRegTime(str) {
	sendAjax(str, "regTime");
}

function sendState(str) {
	sendAjax(str, "state");
}

function sendWinner(str) {
	sendAjax(str, "winner");
}

function hex2S(str1) {
	var hex = str1.toString();
    var str = '';
    for (var i = 0; i < hex.length; i += 2) {
        var v = parseInt(hex.substr(i, 2), 16);
        if (v) str += String.fromCharCode(v);
    }
    return str;
}   


function hex2SArray(str1) {;
	var hex1 = str1.toString();;
	var hexArray = hex1.split(",");
	var newList = [];
	for (var j = 0; j < hexArray.length; j++) {
    	var str = '';
    	for (var i = 0; i < hexArray[j].length; i += 2) {
        	var v = parseInt(hexArray[j].substr(i, 2), 16);
        	if (v) str += String.fromCharCode(v);

        	
    	}
		newList.push(str);
		console.log(str);
    }
    return newList;
}  